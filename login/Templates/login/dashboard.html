<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tableau de bord - CoinPattern</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem 1rem;
    }

    .container {
      max-width: 900px;
      width: 100%;
    }

    .card {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 2.5rem;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(10px);
      text-align: center;
    }

    h1 {
      color: #333;
      font-size: 2.5rem;
      margin-bottom: 1rem;
      font-weight: 700;
    }

    h3 {
      color: #333;
      font-size: 1.5rem;
      margin: 2rem 0 1rem 0;
      font-weight: 600;
    }

    p {
      color: #666;
      line-height: 1.6;
      margin-bottom: 1rem;
      font-size: 1.1rem;
    }

    .pattern-container {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin: 2rem 0;
      padding: 1.5rem;
      background: #f9fafb;
      border-radius: 15px;
    }

    .coin {
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      font-weight: 700;
      color: #78350f;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      user-select: none;
    }

    .total-display {
      font-size: 1.8rem;
      font-weight: bold;
      color: #333;
      margin: 2rem 0;
    }

    .btn-group {
      display: flex;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
      margin: 2rem 0;
    }

    .btn {
      padding: 1rem 2rem;
      font-size: 1.1rem;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      font-weight: 600;
      text-decoration: none;
      display: inline-block;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .btn-success {
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      color: white;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }

    .btn:active {
      transform: translateY(-1px);
    }

    .empty-pattern {
      color: #999;
      font-style: italic;
      padding: 2rem;
    }

    .welcome-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-10px);
      }
    }

    @media (max-width: 768px) {
      body {
        padding: 1rem 0.5rem;
      }

      .card {
        padding: 2rem 1.5rem;
      }

      h1 {
        font-size: 2rem;
      }

      h3 {
        font-size: 1.25rem;
      }

      p {
        font-size: 1rem;
      }

      .pattern-container {
        gap: 0.5rem;
        padding: 1rem;
      }

      .coin {
        width: 50px;
        height: 50px;
        font-size: 0.9rem;
      }

      .total-display {
        font-size: 1.5rem;
      }

      .btn {
        padding: 0.875rem 1.5rem;
        font-size: 1rem;
      }

      .btn-group {
        flex-direction: column;
        align-items: stretch;
      }

      .btn {
        width: 100%;
      }
    }

    @media (max-width: 480px) {
      .card {
        padding: 1.5rem 1rem;
      }

      h1 {
        font-size: 1.75rem;
      }

      .welcome-icon {
        font-size: 2.5rem;
      }

      .coin {
        width: 45px;
        height: 45px;
        font-size: 0.85rem;
      }

      .total-display {
        font-size: 1.25rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <!-- Authenticated User View -->
      <div id="authenticated-view">
        <div class="welcome-icon">üëã</div>
        <h1>Bonjour √† nouveau, <span id="username">Utilisateur</span> !</h1>
        <p>Votre compte est prot√©g√© par votre motif de pi√®ces unique.</p>

        <h3>Votre motif enregistr√©</h3>
        <div class="pattern-container" id="pattern-container">
        </div>

        <p class="total-display">
          Total : <span id="total">0</span> <span id="currency">MRU</span>
        </p>

        <div class="btn-group">
          <a href="{% url 'edit_pattern' %}" class="btn btn-success">√âditer mon motif</a>
          <a href="{% url 'logout' %}" class="btn btn-primary" id="logout-btn">Se d√©connecter</a>
        </div>
      </div>

      <!-- Not Authenticated View (hidden by default) -->
      <div id="not-authenticated-view" style="display: none;">
        <h1>Non connect√©</h1>
        <p>Vous devez vous connecter avec votre motif de pi√®ces.</p>
        <a href="#" class="btn btn-primary" id="login-btn">Connexion</a>
      </div>
    </div>
  </div>

<!-- ins√©rer avant ton script JS -->
{{ user.pattern_list|default:"[]"|json_script:"pattern-list" }}

<script>
const userData = {
  isAuthenticated: true,
  username: "{{ user.username|escapejs }}",
  pattern: JSON.parse(document.getElementById('pattern-list').textContent),
  total: Number("{{ user.total|default:'0' }}"),
  currency: "{{ user.currency|default:'MRU'|escapejs }}"
};

function renderDashboard() {
    const authenticatedView = document.getElementById('authenticated-view');
    const notAuthenticatedView = document.getElementById('not-authenticated-view');
    const patternContainer = document.getElementById('pattern-container');

    if (userData.isAuthenticated) {
        authenticatedView.style.display = 'block';
        notAuthenticatedView.style.display = 'none';

        document.getElementById('username').textContent = userData.username || "Utilisateur";
        document.getElementById('total').textContent = userData.total || 0;
        document.getElementById('currency').textContent = userData.currency || "MRU";

        patternContainer.innerHTML = '';

        if (Array.isArray(userData.pattern) && userData.pattern.length > 0) {
            userData.pattern.forEach(value => {
                const coin = document.createElement('div');
                coin.className = 'coin';
                coin.textContent = value;
                patternContainer.appendChild(coin);
            });
        } else {
            patternContainer.innerHTML = '<p class="empty-pattern">Aucun motif enregistr√©</p>';
        }

    } else {
        authenticatedView.style.display = 'none';
        notAuthenticatedView.style.display = 'block';
    }
}

renderDashboard();
</script>


</body>
</html>